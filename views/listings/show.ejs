<body>
	<% layout("layouts/boilerplate.ejs") %>

		<div class="row">
			<div class="col-8 offset-2">
				<h4><b>
					<%= listing.title %>
				</b></h4>
			</div>
			<div class="col-8	 offset-2" >
				<div class="card no-hover">
					<img src="<%= listing.image %>" class="card-img-top show-image" alt="listing-image">
					<div class="card-body">
						<!-- <h5 class="card-title" style="text-align: center;margin-top: 5px;">
							
						</h5> -->
						<br>
						<p class="card-text">

							<b>Description: </b><%= listing.description %>
								<br>
								<b>Price: </b>₹<%= listing.price.toLocaleString("en-IN") %>
									<br>

									<b>Location: </b><%= listing.location %>

										<br>
										<b>Country: </b><%= listing.country %>
									<div class="col-1 btns">
											<a href="/listings/<%= listing._id %>/edit" class="btn btn-edit">Edit</a>
											<form method="post" action="/listings/<%= listing._id%>?_method=DELETE" style="padding: 0; margin-left: 1rem;">
												<button id="delete" type="submit" class="btn btn-dark">Delete</button>
											</form>
										</div> 									
					</div> 		
				</div>
			<hr>
			<h4>Leave a Review</h4>
			</div>

         <!-- reviews --> 
			<form action="/listings/<%= listing.id %>/reviews" method="post" class="needs-validation" novalidate>
				<div class="col-6 offset-2" >

					<div  class="mb-3">
						<label for="rating" class="form-label">Rating:</label>
					<input type="range" min= 1 max="5" id="rating" name="review[rating]" class="form-range" >
					</div>

					<div  class="mb-3">
						<label for="comment" class="form-label"  >Comment:</label>
					<textarea name="review[comment]" id="comment" cols="30" rows="1" class="form-control" placeholder="..." required></textarea>
					<div class="valid-feedback">
                        Looks good!
                    </div>
                    <div class="invalid-feedback">
                        Please add some comment.
                    </div>

					</div>
					<div  class="mb-3">
						<button class="btn btn-outline-dark">Submit</button>
					</div>
				</div>
			</form>

			<div class="col-8 offset-2 mb-4">
				<hr id="review-hr" style="display: none;">
				<div id="reviews-header" style="display: none;">
					<h4>All Reviews</h4>
				</div>
				
				<div class="reviews-container">
					<% for(let review of listing.reviews) { %>
						<div class="review-card">
							<div class="stars">
								<% for(let i = 0; i < 5; i++) { %>
									<% if(i < review.rating) { %>
										<span class="star filled">★</span>
									<% } else { %>
										<span class="star">★</span>
									<% } %>
								<% } %>
							</div>
							<p class="comment"><%= review.comment %></p>
							<form method="post" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" >
								<button type="submit" class="delete-btn">Delete</button>
							</form>
						</div>
					<% } %>
				</div>
			</div>
			
</body>